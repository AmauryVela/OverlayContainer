os: osx
osx_image: xcode10.1
language: swift

branches:
  only:
    - master
cache:
  - bundler
podfile: Example/Podfile

env:
  global:
  - LANG=en_US.UTF-8
  - LC_ALL=en_US.UTF-8
  - DESTINATION="OS=12.1,name=iPhone XS"
  - SCHEME="OverlayContainer"
  - WORKSPACE="OverlayContainer.xcworkspace"
skip_cleanup: true

jobs:
  include:

  - stage: Carthage
    before_install:
    - brew update
    - brew outdated carthage || brew upgrade carthage
    script:
    - carthage build --no-skip-current

  - stage: podspec
    script:
    - pod spec lint

  - stage: Build
    script:
    - set -o pipefail && xcodebuild -workspace "$WORKSPACE" -scheme "$SCHEME" -destination "$DESTINATION" ONLY_ACTIVE_ARCH=NO | xcpretty

  - stage: Tests
    script:
    - set -o pipefail && xcodebuild test -enableCodeCoverage YES -workspace "$WORKSPACE" -scheme "$SCHEME" -destination "$DESTINATION" ONLY_ACTIVE_ARCH=NO | xcpretty
